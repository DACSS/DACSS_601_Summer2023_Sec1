{
  "hash": "90d2bfd9d3132b98bbb0343ca8f93b51",
  "result": {
    "markdown": "---\ntitle: \"Final Project -- Formula 1 Rule Change Analysis\"\nauthor: \"Audrey Bertin\"\ndescription: \"How did the 2022 F1 Rule Change Affect the Sport?\"\ndate: \"7/10/2023\"\nformat:\n  html:\n    df-print: paged\n    toc: true\n    code-fold: true\n    code-copy: true\n    code-tools: true\ncategories:\n  - final_project\n  - formula_1\n  - audrey_bertin\n\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\nI have been regularly watching Formula 1 for the last few years. In that time, there was a significant rule change that--purely observationally--appears to have changed the sport. It is not clear entirely how much or in what ways, so in this project, I want to dig into the data to see if I can come to some evidence-based conclusions.\n\n## F1: A Primer\n\nFormula 1 (F1) is the top class of single-seater motorsport racing. \"Formula\" refers to the set of rules to which all participants' cars must conform. For example, Formula 2 has different rules about car design and racing than Formula 1.\n\nAn F1 season consists of a series of races, known as Grands Prix (GP), which take place around the world on purpose-built racing circuits as well as public roads (termed \"street circuits\"). The number and location of races per season has varied significantly across the years.\n\nThere are currently 10 teams in Formula 1, officially termed \"Constructors\". Like the races, the number of teams (and names) has varied significantly over time. Each team has *two* drivers who race for them each season (as well as a driver on standby in case one of the primary drivers get sick/injured). \n\nEach Constructor is responsible for designing their own car each season within a shared set of regulations that restrict the design across all teams (e.g. a minimum weight, certain aerodynamic requirements, etc.). Some Constructors are known as \"works teams\". These teams design and construct the engines for their cars *in addition* to the aerodynamic components. The rest of the teams are called \"customer teams\". They design the aerodynamic parts of their car, but *purchase* their engines from one of the works teams instead of designing it themselves. For example, currently, the Mercedes *works* team uses their engines for their own car and  *also* provides engines to the Williams and McLaren teams. \n\nThere is also the concept of \"junior teams\", where one company essentially has ownership over multiple teams in F1. They have one primary, A-team, and then a B-team that they can use to develop talent for their A-team. For example, currently Red Bull owns both the Red Bull Racing *and* Alpha Tauri teams, and regularly promote their drivers from Alpha Tauri to Red Bull Racing. For the purposes of the championship, however, these are considered *separate* constructors.\n\nBecause each Constructor designs their own car, cars can vary quite dramatically across teams, so there tends to be a somewhat clear hierarchy. The \"worst\" car often has nearly zero chance of winning a race, and the \"best\" cars almost always end up on the podium. In formula 1 lingo, teams are broken into three categories:\n\n- \"top\" teams -- these teams win most of the races / usually make up the podium\n- \"midfield\" teams -- these teams are not as fast as the top teams but often still place reasonably well and can, on occasion, end up on the podium or even (in rare cases) win a race\n- \"backmarker\" teams -- these teams are significantly slower than the others, with *almost no* chance of ending up on the podium, and usually finish near the back of the pack\n\nDue to this team hierarchy, it can be difficult to compare a driver from one team to a driver on another. Just because one driver always has faster lap times or finishes in a better position does not mean that they are necessarily a better driver, and could just mean that they have a better car. Since both teammates on a given team drive the same car, driver skill is often judged more-so based on how well a driver does compared to their teammates. \n\nIn each season, there are two separate championships up for grabs -- a **Drivers Championship** and a **Constructors Championship**. The Drivers Championship is considered more prestigious and awards the individual driver who received the most points throughout the season. The Constructors Championship is awarded to the *team* with the most *combined* points across their two drivers. \n\nTeams and drivers have the chance to earn points at each Grand Prix (note that there are also points available in what are called \"Sprint races\", but these are a new feature in F1 and we'll be excluding them for the purposes of this analysis in order to simplify things).\n\nEach GP occurs over one weekend is broken up into two segments: qualifying (typically on Saturday) and the race (typically on Sunday). In qualifying, drivers try to put together the *fastest* lap. Lap times then determine the order that the cars will start for the race.\n\nWithin the race, cars are required to make *at least one* pit stop to change which type of tires they are using (there are hard, medium, and soft tires available for each race, each of which have different pros and cons). Depending on how much a given track damages the tires, along with other factors such as if a car is involved in a collision, additional pitstops may take place to change tires or swap out parts.\n\nAt the end of the race, points are awarded based on drivers' finishing position. Additionally, the driver who records the fastest single lap throughout the race is awarded an extra point in addition to their points for finishing position. \n\nThe current points distribution is as follows:\n\n- 1st place: 25 pts\n- 2nd place: 18 pts\n- 3rd place: 15 pts\n- 4th place: 12 pts\n- 5th place: 10 pts\n- 6th place: 8 pts\n- 7th place: 6 pts\n- 8th place: 4 pts\n- 9th place: 2 pts\n- 10th place: 1 pt\n- Fastest Lap: 1 pt \n- 11th-20th place: 0 pts\n\nPoints are cumulative across a season, and the championships are awarded to the team and driver with the highest point totals.\n\n## Dataset\n\nData on Formula 1 is available through Kaggle at the following link\nhttps://www.kaggle.com/datasets/rohanrao/formula-1-world-championship-1950-2020\n\nIt contains F1 race data from the series' start in 1950 to the present season, which is currently in-progress and will run until November. This data was likely scraped from the official F1 website, which publishes detailed information after every race, and so it is likely to be accurate and official.\n\nThere are 14 separate files within this dataset that store different types of information:\n\n- `circuits.csv` contains information about the different tracks the drivers race on (a row here is a track). There are 77 total circuits raced on since 1950.\n- `constructor_standings.csv` contains information about how many points each team has after each race (a row here is a single team at a single race). We have 12,941 data points for the standings.\n- `constructors.csv` stores the names and nationalities of teams (a row here is a team). There have been 211 total teams since 1950, and there are currently 10 active teams.\n- `driver_standings.csv` stores information about how many points each driver was awarded at each race (a row here is a single driver at a single race). We have 33,902 records on drivers standings across all of the races. \n- `drivers.csv` stores the names and nationalities of drivers (a row here is a driver). There are 857 recorded drivers.\n- `lap_times.csv` stores the lap times for every driver on every lap of each race (a row here is a single lap for a single driver at a single race). We have 538,121 lap times.\n- `pit_stops.csv` stores information about every pit stop taken during each race (a row here is a single pit stop taken by a single driver at a single race). We have 9,634 recorded pit stops.\n- `qualifying.csv` stores qualifying lap times for each driver from each GP (a row here is a single driver in a single GP, and each row contains all qualifying lap times across multiple sessions). We have 9,575 observations here.\n- `races.csv` contains information about each GP, e.g. track name, date, etc. (a row here is a single GP). There are 1102 recorded races here.\n- `results.csv` contains all of the finishing results for each race, e.g. driver finishing positions, # laps completed, fastest lap (a row here is a single driver at a single race). There are 25,840 observations.\n- `seasons.csv` contains the years and urls for wikipedia pages associated with each season (a row here is a season). There are 74 seasons, covering 1950-2023.\n- `sprint_results.csv` same as results.csv but for sprint races, which we'll be excluding as they are currently just a new feature that F1 is testing (a row here is a single sprint race). There are 120 recorded observations, a very small number since there have only been a handful of these.s\n- `status.csv` contains the encodings of a `status` variable that is referenced in the results files (a row here is a status). There are 139 unique statuses.\n\nWe complete a cleaning of these datasets below (see homework 1 for more details on these modifications):\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Circuits\ncircuits <- readr::read_csv(\"_data/formula1/circuits.csv\")\ncircuits <- circuits %>%\n  rename(circuit_name = name) %>%\n  select(-alt)\n\n# Constructors Standings\nconstructor_standings <- readr::read_csv(\"_data/formula1/constructor_standings.csv\")\nconstructor_standings <- constructor_standings %>%\n  select(-positionText)\n\n# Constructors\nconstructors <- readr::read_csv(\"_data/formula1/constructors.csv\")\nconstructors <- constructors %>%\n  rename(constructor_name = name)\n\n# Drivers Standings\ndriver_standings <- readr::read_csv(\"_data/formula1/driver_standings.csv\")\ndriver_standings <- driver_standings %>%\n  select(- positionText)\n\n# Drivers\ndrivers <- readr::read_csv(\"_data/formula1/drivers.csv\")\ndrivers <- drivers %>%\n  mutate(number = na_if(number, \"\\\\N\"))\n\n# Lap Times\nlap_times <- readr::read_csv(\"_data/formula1/lap_times.csv\")\nlap_times <- lap_times %>%\n  mutate(laptime_seconds = milliseconds/1000) %>%\n  select(-c(time, milliseconds))\n\n# Pit Stops\npit_stops <- readr::read_csv(\"_data/formula1/pit_stops.csv\")\n\n# Qualifying\nqualifying <- readr::read_csv(\"_data/formula1/qualifying.csv\")\nqualifying <- qualifying %>%\n  select(-number) %>%\n  mutate(across(q1:q3, ~ period_to_seconds(ms(na_if(.x, \"\\\\N\"))))) %>%\n  rename(q1_time_s = q1, q2_time_s = q2, q3_time_s = q3)\n\n# Races\nraces <- readr::read_csv(\"_data/formula1/races.csv\")\nraces <- races %>%\n  select(raceId:name) %>%\n  rename(gp_name = name)\n\n# Results\nresults <- readr::read_csv(\"_data/formula1/results.csv\")\nresults <- results %>%\n  mutate(\n    disqualified = as_factor(ifelse(positionText == \"D\", 1, 0)),\n    retired = as_factor(ifelse(positionText == \"R\", 1, 0)),\n    fastestLap = as.numeric(fastestLap),\n    rank = as.numeric(rank),\n    fastestLapTime = period_to_seconds(ms(na_if(fastestLapTime, \"\\\\N\"))),\n    fastestLapSpeed = as.numeric(fastestLapSpeed),\n    finishTimeSeconds = as.numeric(na_if(milliseconds, \"\\\\N\"))/1000) %>%\n  rename(start_position = grid, finish_position = positionOrder) %>%\n  select(-c(number, position, positionText, time, milliseconds)) \n\n# Seasons\nseasons <- readr::read_csv(\"_data/formula1/seasons.csv\")\n\n# Status\nstatus <- readr::read_csv(\"_data/formula1/status.csv\")\n```\n:::\n\n\n\nA few key notes that are important to share about the datasets above include:\n\n#### Qualifying\n\nThe qualifying dataset is hard to interpret for early races, but should work well for recent races. This is because it uses the current qualifying format to store data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqualifying %>% head(3)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"qualifyId\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"raceId\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"driverId\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"constructorId\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"position\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"q1_time_s\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"q2_time_s\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"q3_time_s\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"18\",\"3\":\"1\",\"4\":\"1\",\"5\":\"1\",\"6\":\"86.572\",\"7\":\"85.187\",\"8\":\"86.714\"},{\"1\":\"2\",\"2\":\"18\",\"3\":\"9\",\"4\":\"2\",\"5\":\"2\",\"6\":\"86.103\",\"7\":\"85.315\",\"8\":\"86.869\"},{\"1\":\"3\",\"2\":\"18\",\"3\":\"5\",\"4\":\"1\",\"5\":\"3\",\"6\":\"85.664\",\"7\":\"85.452\",\"8\":\"87.079\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nQ1, Q2, and Q3 are three different segments of the current qualifying format, which was not introduced into 2016. Q1/2/3 did not exist prior to this in Formula 1, where qualifying took a lot of different formats. For a quick look at alternative historical formats, see [here](https://www.formula1.com/en/latest/features/2016/3/deciding-the-grid-a-history-of-f1-qualifying-formats.html).\n\nDue in part to this, and the interest specifically in the most recent rule change, for this analysis, we'll focus just on data from 2016 onward!\n\nThis dataset also has a lot of missing data. Looking just at data from after 2016 or later, the fraction of missing values for each of the qualifying time columns is shown below: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nqualifying %>%\n  filter(raceId >= 968) %>%\n  select(contains(\"_time_s\")) %>%\n  summarize_all(~sum(is.na(.x))/n())\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"q1_time_s\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"q2_time_s\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"q3_time_s\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0.01170771\",\"2\":\"0.2656439\",\"3\":\"0.5115059\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n51% of Q3 data is missing, 26% of Q2, and very little for Q1. This is not actually a missing data error, but rather what we would expect based on the qualifying format. Qualifying works as follows:\n\n- In Q1, all drivers participate (unless there is some sort of mechanical issue preventing them from doing so). Drivers are ranked based on their fastest last time. The fastest 15 move on to Q2, while the slowest 5 are eliminated and take positions 20-16 on the starting lineup for the race based on time.\n- In Q2, the top 15 again race for fastest single lap. This time, the fastest 10 move on and the bottom 5 are eliminated, again in race order of lap time, filling in positions 15-11.\n- In Q3, the fastest 10 from Q2 race again for fastest single lap. No one is eliminated, but fastest lap times determine which position each of the top half of drivers will start, filling in positions 10-1.\n\nIf a driver does not race in one of the sessions, they won't have a time recorded.\n\nGiven this, the missing data values indicate that we actually have essentially all of the data. Very few drivers are missing from Q1. About 25% are missing from Q2, which is exactly what we would expect since the bottom 5 do not participate. Same with Q3, where we are missing half the records. \n\nLap times typically get faster (smaller) from Q1 to Q3 as the intensity ramps up. We see this reflected in the data when we look at averages and standard deviations for each session:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqualifying %>%\n  filter(raceId >= 968) %>%\n  select(contains(\"time_s\")) %>%\n  rename(q1 = q1_time_s, q2 = q2_time_s, q3 = q3_time_s) %>%\n  pivot_longer(everything(), names_to = \"session\", values_to = \"time_s\") %>%\n  group_by(session) %>%\n  summarize(mean_time = mean(time_s, na.rm=TRUE), sd_time = sd(time_s, na.rm=TRUE))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"session\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"mean_time\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sd_time\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"q1\",\"2\":\"86.16998\",\"3\":\"12.82563\"},{\"1\":\"q2\",\"2\":\"85.28996\",\"3\":\"12.29279\"},{\"1\":\"q3\",\"2\":\"85.08618\",\"3\":\"12.53103\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n#### Lap Times\n\nWe have information on lap times for each lap of the races that we can use to track whether cars are faster/slower over time. Looking at lap times across a handful of different Grands Prix from 2016-present, we can see they vary significantly across tracks:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlap_times %>%\n  inner_join(races, by = 'raceId') %>%\n  filter(laptime_seconds < 300, raceId >= 968, gp_name %in% c(\"Abu Dhabi Grand Prix\", \"Belgian Grand Prix\", \"Hungarian Grand Prix\", \"Monaco Grand Prix\")) %>%\n  ggplot(aes(x=laptime_seconds, fill = gp_name)) + geom_histogram(alpha = 0.3) + xlab(\"Lap Time in Seconds\") + ylab(\"Count\") + ggtitle(\"Distribution of Lap Times, 2016-present for several GPs\") + theme_minimal() + scale_fill_brewer(palette = \"Set1\")\n```\n\n::: {.cell-output-display}\n![](AudreyBertin_FinalProject_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nWe can also use this data to view trends over time:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlap_times %>%\n  inner_join(races, by = 'raceId') %>%\n  filter(laptime_seconds < 300, raceId >= 968, gp_name %in% c(\"Abu Dhabi Grand Prix\", \"Belgian Grand Prix\", \"Hungarian Grand Prix\", \"Monaco Grand Prix\")) %>%\n  group_by(raceId, gp_name) %>%\n  summarize(avg_lap = mean(laptime_seconds)) %>%\n  ggplot(aes(x= raceId, y=avg_lap, color=gp_name)) + geom_line() + xlab(\"Race ID\") + ylab(\"Avg Lap Time in Seconds\") + ggtitle(\"Avg Lap Times From 2016-present for several GPs\") + theme_minimal()\n```\n\n::: {.cell-output-display}\n![](AudreyBertin_FinalProject_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nNote the crazy spike we see here for the Belgian GP. This spike corresponds to the race in 2021 where there was a *huge* rain issue which slowed all the cars and resulted in such dangerous conditions that they could not complete a full race. See: https://www.formula1.com/en/racing/2021/Belgium.html.\n\n#### Status\n\nIn the results data, there is some basic information on driver status that we can use to track how many drivers are completing races over time. We have information on how many drivers were disqualified, retired, or finished successfully, and we can use this to view trends over time (including over the time period we are interested in).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresults %>%\n  mutate(finished = as_factor(ifelse(statusId == 1, 1, 0))) %>%\n  select(raceId, disqualified, retired, finished) %>%\n  pivot_longer(disqualified:finished, names_to = \"status\", values_to = \"status_met\") %>%\n  filter(status_met == 1) %>%\n  group_by(raceId, status) %>%\n  summarize(count = n()) %>%\n  ggplot(aes(x=raceId, y=count, color=status)) + geom_smooth()\n```\n\n::: {.cell-output-display}\n![](AudreyBertin_FinalProject_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nIn addition to these basic statuses, we have another column called `statusId` that can be used to find patterns about driver performance and car reliability. This column is linked to the `status` dataset, which stores the encodings for these statuses:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(status)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"statusId\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"status\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1\",\"2\":\"Finished\"},{\"1\":\"2\",\"2\":\"Disqualified\"},{\"1\":\"3\",\"2\":\"Accident\"},{\"1\":\"4\",\"2\":\"Collision\"},{\"1\":\"5\",\"2\":\"Engine\"},{\"1\":\"6\",\"2\":\"Gearbox\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\nThese can tell us more information about what happened to a driver in a particular race. We can see who loses races for a driver related reasons (e.g. \"Accident\"/\"Collision\") versus car failure (e.g. \"Engine\", \"Gearbox\"). We can see the most common statuses since 2016 below:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop_statuses <- results %>%\n  inner_join(status,by=\"statusId\") %>%\n  filter(raceId >= 968) %>%\n  group_by(statusId, status) %>%\n  summarize(n = n()) %>%\n  arrange(desc(n)) \n\ntop_statuses %>%\n  head(15) %>%\n  ggplot(aes(x=reorder(status,n), y=n)) + geom_col() +\n  ggtitle(\"Most Common Race Statuses by Count Since 2016\") + theme_minimal() + xlab(\"Status\") + ylab(\"Count\") + coord_flip()\n```\n\n::: {.cell-output-display}\n![](AudreyBertin_FinalProject_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n## Research Questions\n\nUsing this data, I'd like to investigate how Formula 1 has shifted before and after the most recent regulation change in 2022.\n\nThis change shifted how F1 cars look and perform, with new engine requirements, weight requirements, and aerodynamic guidelines. Just by watching (and not looking at any data) this change seems to have shaken things up considerably, finally ending the Mercedes' team's dominant win streak in the Constructors championship and seeing Red Bull take first place instead.\n\nI'm interested in using this dataset to take a deeper look into how things have changed since the regulations shift -- comparing the previous era to the new era, which started in 2022. \n\nThere are a few different aspects of this this comparison that are of interest:\n\n1. The new regulations were designed to make it easier for cars to follow one another, theoretically making passing easier. How has this translated in reality? Is it easier now than before for \"top\" cars that start out of position to make up positions? Being \"out of position\" here means starting the race from a position worse than would be expected based on their car's performance due to a qualifying mistake, mechanical failure, etc.\n\n2. How have lap times changed, both in qualifying and the race? Are the new cars getting faster/slower overall? Is this change the same across all race tracks?\n\n3. How has car reliability changed? Are mechanical failures in races more common or less common than before? Are certain types of failures popping up that we didn't see much of before (or the opposite)?\n\n4. Which drivers did the best job adapting to the regulations? We could look into how lap times changed overall on average, and then compare how close each driver's lap time changes were to the mean. \n\n5. How did the regulations shake up the order in the Constructors championships? Did any teams go from dominant to mediocre? Did anyone suddenly shoot up?\n\nWe will look at these questions one by one.\n\nNote: The previous era prior to the regulation change, called the Turbo Hybrid era, technically started in 2014. However, due to a shift in qualifying formats in 2016, we will ignore 2014/15 and just look at 2016-2021 (\"Before\") and 2022 (\"After\") as our two comparison periods. We will also exclude the 2023 season as it is still not complete and data is not properly updated yet.\n\n\n#### Is it easier to follow?\n\n#### How have lap times changed?\n\n#### How has reliability changed?\n\n#### Which drivers adapted best to the regulations?\n\n#### How did the regulation change shake up the championship?\n\nFor this question, we'll separately look at the Constructors Standings and Drivers Standings. \n\nLet's start with the Constructors. Do we see a significant change in the lineup of teams before and after the change? To determine this, we can create a timeseries plot showing how team placings changed season by season from 2016-2022.\n\nWe start by joining the constructors and races tables together:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Join constructor results table to more information on constructors and races\nconstructor_results <- constructor_standings %>% \n  inner_join(constructors, by = 'constructorId') %>%\n  inner_join(races, by = 'raceId')\n\nhead(constructor_results)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"constructorStandingsId\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"raceId\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"constructorId\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"points\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"position\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"wins\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"constructorRef\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"constructor_name\"],\"name\":[8],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"nationality\"],\"name\":[9],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"url\"],\"name\":[10],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"year\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"round\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"circuitId\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"gp_name\"],\"name\":[14],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1\",\"2\":\"18\",\"3\":\"1\",\"4\":\"14\",\"5\":\"1\",\"6\":\"1\",\"7\":\"mclaren\",\"8\":\"McLaren\",\"9\":\"British\",\"10\":\"http://en.wikipedia.org/wiki/McLaren\",\"11\":\"2008\",\"12\":\"1\",\"13\":\"1\",\"14\":\"Australian Grand Prix\"},{\"1\":\"2\",\"2\":\"18\",\"3\":\"2\",\"4\":\"8\",\"5\":\"3\",\"6\":\"0\",\"7\":\"bmw_sauber\",\"8\":\"BMW Sauber\",\"9\":\"German\",\"10\":\"http://en.wikipedia.org/wiki/BMW_Sauber\",\"11\":\"2008\",\"12\":\"1\",\"13\":\"1\",\"14\":\"Australian Grand Prix\"},{\"1\":\"3\",\"2\":\"18\",\"3\":\"3\",\"4\":\"9\",\"5\":\"2\",\"6\":\"0\",\"7\":\"williams\",\"8\":\"Williams\",\"9\":\"British\",\"10\":\"http://en.wikipedia.org/wiki/Williams_Grand_Prix_Engineering\",\"11\":\"2008\",\"12\":\"1\",\"13\":\"1\",\"14\":\"Australian Grand Prix\"},{\"1\":\"4\",\"2\":\"18\",\"3\":\"4\",\"4\":\"5\",\"5\":\"4\",\"6\":\"0\",\"7\":\"renault\",\"8\":\"Renault\",\"9\":\"French\",\"10\":\"http://en.wikipedia.org/wiki/Renault_in_Formula_One\",\"11\":\"2008\",\"12\":\"1\",\"13\":\"1\",\"14\":\"Australian Grand Prix\"},{\"1\":\"5\",\"2\":\"18\",\"3\":\"5\",\"4\":\"2\",\"5\":\"5\",\"6\":\"0\",\"7\":\"toro_rosso\",\"8\":\"Toro Rosso\",\"9\":\"Italian\",\"10\":\"http://en.wikipedia.org/wiki/Scuderia_Toro_Rosso\",\"11\":\"2008\",\"12\":\"1\",\"13\":\"1\",\"14\":\"Australian Grand Prix\"},{\"1\":\"6\",\"2\":\"18\",\"3\":\"6\",\"4\":\"1\",\"5\":\"6\",\"6\":\"0\",\"7\":\"ferrari\",\"8\":\"Ferrari\",\"9\":\"Italian\",\"10\":\"http://en.wikipedia.org/wiki/Scuderia_Ferrari\",\"11\":\"2008\",\"12\":\"1\",\"13\":\"1\",\"14\":\"Australian Grand Prix\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nWe can then filter this to the years and columns relevant to us, and group by/summarize to find the total number of points each team got each season:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nconstructors_ranked <- constructor_results %>%\n  filter(year >= 2016 & year < 2023)  %>%\n  select(year, raceId, position, points, constructor_name) %>%\n  group_by(year, constructor_name) %>%\n  summarize(final_points = max(points))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nconstructors_ranked %>%\n  ggplot(aes(x = year, y = final_points, color = constructor_name)) + \n  geom_line() + \n  theme_minimal() + \n  xlab(\"Season\") +\n  ylab(\"Constructors' Championship Points\") +\n  ggtitle(\"Points Earned In The Constructors' Championship, 2016-2022\", subtitle = \"Using Historic Team Names\")\n```\n\n::: {.cell-output-display}\n![](AudreyBertin_FinalProject_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nAlthough these teams all have separate names and designations, some of them are actually the *same* team, just in different years. For example, the current \"Alpha Tauri\" team used to be called \"Toro Rosso\". In order to keep the teams joined together through name changes, we can recategorize the team names as just their current name and also remove the teams that no longer existed in the 2022 season. This helps make our graph easier to follow so we can better trace the changes over time.\n\nIn this iteration, we'll also add a vertical line to indicate the transition year. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nconstructors_ranked %>%\n  filter(constructor_name != \"Manor Marussia\") %>%\n  mutate(constructor_recat = \n           case_when(\n             constructor_name %in% c(\"AlphaTauri\", \"Toro Rosso\") ~ \"Alpha Tauri\",\n             constructor_name %in% c(\"Alfa Romeo\", \"Sauber\") ~ \"Alfa Romeo\",\n             constructor_name %in% c(\"Alpine F1 Team\", \"Renault\") ~ \"Alpine\",\n             constructor_name %in% c(\"Aston Martin\", \"Racing Point\", \"Force India\") ~ \"Aston Martin\",\n             TRUE ~ constructor_name\n             \n         )) %>%\n  ggplot(aes(x = year, y = final_points, color = constructor_recat)) + \n  geom_line() + \n  geom_vline(xintercept = 2021) + \n  theme_minimal() +\n  xlab(\"Season\") +\n  ylab(\"Constructors' Championship Points\") +\n  ggtitle(\"Points Earned In The Constructors' Championship, 2016-2022\", subtitle = \"Using Current Team Names\")\n```\n\n::: {.cell-output-display}\n![](AudreyBertin_FinalProject_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nAs we can see here, relative rankings in the championship remained pretty steady for a good part of the old regulations, with Mercedes dominant, Ferrari having a few good years, and Red Bull close behind. \n\nAfter the regulations change, Mercedes dropped from 1st to 3rd place and Red Bull and Ferrari had massive spikes in points. However, note that they were on the up-swing before the change was put in place (in 2021) so it could be unrelated. McLaren did not seem to take the change well. They were previously on an upward points scoring trend and shot down in 2022. We see the same trend with Alpha Tauri. Meanwhile, Hass and Alfa Romeo, who in previous years had struggled to score any points did see a small jump in points and a positive shift in their overall rankings.\n\nIt is hard to tell fully, without a few more years worth of data, but it does appear that the regulation change did switch the team rankings up and some teams (Red Bull/Ferrari) adapted better than others (Alpha Tauri, McLaren).\n\n\n\n## References\n\n\n#### Datasets\n\nRao, R. (2023). Formula 1 World Championship Data: 1950-2023. *Kaggle*.\n<https://www.kaggle.com/datasets/rohanrao/formula-1-world-championship-1950-2020>\n\nFormula 1 (2023). Formula 1 Race Result Archive. *Formula 1*.\n<https://www.formula1.com/en/results.html>\n\n\n#### Overview of F1\n\nFederation International de l'Automobile (FIA). (2023). Regulations: FIA Formula One World Championship. \n<https://www.fia.com/regulation/category/110>\n\nTippett, B. (2021). The Complete Guide To Understanding Formula 1. *Defector*.\n<https://defector.com/the-complete-guide-to-understanding-formula-1>\n\nKanal, S. (2023). The beginner's guide to...the Formula 1 Grand Prix Weekend. *Formula 1*.\n<https://www.formula1.com/en/latest/article.the-beginners-guide-to-the-formula-1-grand-prix-weekend.20OGbgZCWKj9ML79gBzfoX.html>\n\nF1 Chronicle Media Team (2020). The Complete Beginners Guide to Formula 1. *F1 Chronicle*.\n<https://f1chronicle.com/a-beginners-guide-to-formula-1/>\n\n#### Techincal / Software\n\nWickham, H., & Grolemund, G. (2016). R for data science: Visualize, model, transform, tidy, and import data. \n<https://r4ds.had.co.nz> \n\nR Core Team (2023). _R: A Language and Environment for Statistical Computing_. R Foundation for Statistical Computing, Vienna,\n  Austria. <https://www.R-project.org/>.\n\n\n#### Other\n\nFormula 1. (2021). 2021 Belgian Grand Prix. *Formula 1*.\n<https://www.formula1.com/en/racing/2021/Belgium.html>\n\n\n",
    "supporting": [
      "AudreyBertin_FinalProject_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}